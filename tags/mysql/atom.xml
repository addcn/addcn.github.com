<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: mysql | uedao]]></title>
  <link href="http://addcn.github.com/tags/mysql/atom.xml" rel="self"/>
  <link href="http://addcn.github.com/"/>
  <updated>2013-06-05T10:22:18+08:00</updated>
  <id>http://addcn.github.com/</id>
  <author>
    <name><![CDATA[addcn]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[mysql视图表创建与修改]]></title>
    <link href="http://addcn.github.com/blog/2011/07/08/mysql-view-action/"/>
    <updated>2011-07-08T18:43:00+08:00</updated>
    <id>http://addcn.github.com/blog/2011/07/08/mysql-view-action</id>
    <content type="html"><![CDATA[<p>旧博文备份<a href="http://blog.uedao.com/blog/?p=20">http://blog.uedao.com/blog/?p=20</a></p>

<p><strong>1、创建</strong></p>

<pre class="terminal"><code>CREATE&nbsp;[OR REPLACE] [&lt;algorithm attributes&gt;] VIEW [database.]&lt; name&gt; [(&lt;columns&gt;)]<br />
AS&nbsp;&lt;SELECT&nbsp;statement&gt;&nbsp;[&lt;check options&gt;]
</code></pre>


<p>例子：</p>

<pre class="terminal"><code>CREATE VIEW `view_articles`
AS
SELECT
    a.id AS id,
    a.title AS title,
    a.content AS content,
    t.name AS tagname,
    u.firstname AS "username"
FROM `articles` a
    LEFT JOIN `tags` t
        ON a.tag_id = t.id
    LEFT JOIN `users` u
        ON a.user_id = u.id
ORDER BY a.posttime DESC;
</code></pre>


<p><strong>2、修改</strong></p>

<pre class="terminal"><code>ALTER&nbsp;[&lt;algorithm attributes&gt;] VIEW [&lt;database&gt;.]&lt; name&gt; [(&lt;columns&gt;)]<br />
AS&lt;SELECT&nbsp;statement&gt;&nbsp;[&lt;check options&gt;]
</code></pre>


<p>例子：</p>

<pre class="terminal"><code>ALTER VIEW `view_articles`
AS
SELECT
    a.id AS id,
    a.title AS title,
    a.content AS content,
    a.posttime AS posttime,
    t.name AS tagname,
    CONCAT(u.firstname,' ',u.lastname) AS "username"
FROM `articles` a
    LEFT JOIN `tags` t
        ON a.tag_id = t.id
    LEFT JOIN `users` u
        ON a.user_id = u.id
ORDER BY a.posttime DESC;
</code></pre>


<p>修改已经建立好的视图表，最简单的方法就是在phpMyAdmin导出视图表的SQL，然后修改开头的“CREATE”（后面的</p>

<pre class="terminal"><code>ALGORITHM=UNDEFINED DEFINER=`root`@`localhost`&nbsp;SQL SECURITY DEFINER</code></pre>


<p>等不用管，保留它）为<code>ALTER</code>，运行语句即可。</p>

<p><strong>参考文章：</strong></p>

<p><a href="http://database.51cto.com/art/201005/200526.htm">http://database.51cto.com/art/201005/200526.htm</a>
<a href="http://www.sqlinfo.net/mysql/mysql_VIEWS_the_basics.php">http://www.sqlinfo.net/mysql/mysql_VIEWS_the_basics.php</a>
<a href="http://www.java2s.com/Tutorial/MySQL/0180__View/Catalog0180__View.htm">http://www.java2s.com/Tutorial/MySQL/0180<strong>View/Catalog0180</strong>View.htm</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mysql经常使用的10个技巧]]></title>
    <link href="http://addcn.github.com/blog/2011/06/29/ten-mysql-tips/"/>
    <updated>2011-06-29T18:43:00+08:00</updated>
    <id>http://addcn.github.com/blog/2011/06/29/ten-mysql-tips</id>
    <content type="html"><![CDATA[<p>旧博文备份<a href="http://blog.uedao.com/blog/?p=5">http://blog.uedao.com/blog/?p=5</a></p>

<p><strong>1、shell执行sql语句</strong></p>

<pre class="terminal"><code>/usr/local/mysql/bin/mysql -h192.168.1.36 -uaddcn -p'password' -e "use  dev; SELECT * FROM config LIMIT 0,10;"
</code></pre>


<p><strong>2、查看执行线程</strong></p>

<pre class="terminal"><code>/usr/local/mysql/bin/mysqladmin -uaddcn -p'password'  pr
/usr/local/mysql/bin/mysqladmin -uaddcn -p'password' processlist | wc -l  #连接数
</code></pre>


<p><strong>3、kill锁表线程</strong></p>

<pre class="terminal"><code>/usr/local/mysql/bin/mysql -h192.168.1.36 -uaddcn -p'password'
mysql> show processlist;
mysql> kill 102609;
</code></pre>


<p><strong>4、主从同步</strong></p>

<p>从机执行</p>

<pre class="terminal"><code>
/usr/local/mysql/bin/mysql -h192.168.1.36 -uaddcn -p'password'
mysql> show slave status\G;
mysql> stop slave;
mysql> start slave;
</code></pre>


<p><strong>5、数据库备份还原</strong></p>

<p>备份</p>

<pre class="terminal"><code>/usr/local/mysql/bin/mysqldump -h192.168.1.36 -uaddcn -p'password' --opt  dev article > /home/addcn/backup/sql/dev_article_20110625.sql;
/usr/local/mysql/bin/mysqldump -h192.168.1.36 -uaddcn -p'password' --opt  -l --default-character-set=latin1 --skip-set-charset dev >  /home/addcn/backup/sql/dev_`date +%d`.sql;
/usr/local/mysql/bin/mysqldump -h192.168.1.36 -uaddcn -p'password' --opt  -l --default-character-set=latin1 --skip-set-charset dev article >  /home/addcn/backup/sql/dev_article_`date +%d`.sql;
</code></pre>


<p>还原</p>

<pre class="terminal"><code>/usr/local/mysql/bin/mysql -h192.168.1.36 -uaddcn -p'password'
mysql> show databases;
mysql> create database dev;
mysql> drop database dev;
mysql> use dev;
mysql> SET NAMES utf8;
mysql> source /home/addcn/backup/sql/dev_article_20110625.sql;
</code></pre>


<p><strong>6、用户管理</strong></p>

<pre class="terminal"><code>GRANT ALL PRIVILEGES ON *.* TO 'addcn'@'localhost' IDENTIFIED BY  'password' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON dev.* TO 'addcn'@'%' IDENTIFIED BY 'password'  WITH GRANT OPTION;
SET PASSWORD FOR 'addcn'@'localhost' = password('password');
SET PASSWORD FOR 'addcn'@'%' = password('password');
FLUSH PRIVILEGES;
</code></pre>


<p><strong>7、sql复制记录</strong></p>

<pre class="terminal"><code>INSERT INTO `table` SELECT * FROM `table1` WHERE id=1; #无主键
INSERT INTO `table`(`a`,`b`,`c`) SELECT `a`,`b`,`c` FROM `table1` WHERE  id=1 AND posttime<=UNIX_TIMESTAMP('2001-03-26 00:00:00'); #有主键写列
</code></pre>


<p><strong>8、根据两关联表更新其中一表某字段</strong></p>

<pre class="terminal"><code>UPDATE `table` SET a = !a WHERE id = 1; #布尔值取反
UPDATE `table1`,`table2` SET `table1`.id = `table2`.id WHERE  `table1`.id=`table2`.id; #更新
</code></pre>


<p><strong>9、if函数</strong></p>

<pre class="terminal"><code>UPDATE `users` SET money=IF(money>=$monty,money-{$monty},money) WHERE user_id=1001;
</code></pre>


<p>扣费结合 if(mysql_affected_rows()) do_success_action(); 可防止INT字段超最大值而变很大数</p>

<p><strong>10、其它</strong></p>

<pre class="terminal"><code>EXPLAIN SELECT * FROM `article` FORCE INDEX (user_id) WHERE 1; #分析语句
SELECT * FROM `article` FORCE INDEX (user_id) WHERE 1; #强制索引
UPDATE LOW_PRIORITY `article` SET browsenum=browsenum+1 WHERE id='1001'; #滞后更新
</code></pre>



]]></content>
  </entry>
  
</feed>
